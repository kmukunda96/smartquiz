<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>SMART Classes Quiz — Pro</title>
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet" />
<style>
  :root{
    --bg:#f6f8fc; --panel:#ffffff; --ink:#0f1a2a; --muted:#5f6b85;
    --primary:#2e5bff; --primary-dark:#2246c4; --ok:#10b981; --bad:#ef4444; --warn:#ef4444; --hint:#a16207;
    --ring:#d6def4; --shadow:0 10px 30px rgba(17,24,39,.10); --r:14px;
    --card:#fff; --card-muted:#f8fbff;
  }

  html,body{height:100%;width:100%;margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,Arial,sans-serif;}
  body.fs-lock{position:fixed; inset:0; width:100%; height:100dvh; overflow:hidden;}

  .app{display:flex;flex-direction:column;min-height:100dvh;width:100%;padding-bottom:env(safe-area-inset-bottom);}
  .top{height:56px;min-height:56px;background:var(--primary);color:#fff;display:flex;align-items:center;justify-content:space-between;padding:0 12px;padding-left:calc(12px + env(safe-area-inset-left));padding-right:calc(12px + env(safe-area-inset-right));box-shadow:var(--shadow);}
  .brand{font-family:Playfair Display,Georgia,serif;font-weight:700;letter-spacing:.3px;}
  #logo{height:30px;vertical-align:middle}
  .meta{display:flex;gap:8px;align-items:center;font-weight:700;}
  .pill{background:rgba(255,255,255,.16);padding:5px 10px;border-radius:18px;white-space:nowrap}
  .timer-pill{border:1px solid rgba(255,255,255,.35);}

  .stage{flex:1;display:grid;place-items:center;padding:10px;box-sizing:border-box;max-width:100vw;}
  .board{width:min(1100px,96vw);min-height:calc(100dvh - 56px - 20px);background:var(--panel);border-radius:16px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:10px;padding:14px 14px;box-sizing:border-box;}

  .qbar{display:flex;align-items:center;justify-content:space-between;color:var(--muted);font-weight:700;gap:8px;flex-wrap:wrap}
  /* MODIFIED: Added white-space: pre-line to respect line breaks in questions */
  .question{font-size:clamp(18px,3.6vw,28px);line-height:1.3;font-weight:800;margin:6px 0 8px 0;word-break:break-word; white-space: pre-line;}
  .scroll-area{flex:1 1 0;min-height:0;overflow:auto;-webkit-overflow-scrolling:touch;padding-bottom:calc(72px + env(safe-area-inset-bottom));}
  .options{display:grid;grid-auto-rows:minmax(52px,auto);gap:10px;margin-top:6px;}
  .opt{position:relative;display:flex;align-items:center;padding:12px 14px;border-radius:var(--r);background:#f3f6ff;border:1.5px solid var(--ring);color:#16386f;font-weight:600;cursor:pointer;overflow:hidden;transform:translateY(8px);opacity:0;animation:slideIn .38s ease forwards;transition:background .15s,border-color .15s,transform .12s;}
  .opt:hover{background:#e7eeff;border-color:#bcd0ff;}
  .opt.selected{background:var(--primary);color:#fff;border-color:var(--primary);}
  @keyframes slideIn{to{transform:translateY(0);opacity:1;}}

  .btn{padding:12px 14px;border:none;border-radius:12px;font-weight:800;letter-spacing:.3px;cursor:pointer;transition:transform .08s ease,background .18s;user-select:none;}
  .btn:active{transform:translateY(1px);}
  .btn.primary{background:var(--primary);color:#fff;}
  .btn.primary:hover{background:var(--primary-dark);}
  .btn.ghost{background:#eef2ff;border:1.5px solid var(--ring);color:#17386e;}
  .btn.warn{background:#ffe8e8;color:#8b1c1c;border:1.5px solid #ffd0d0;}
  .btn.danger{background:var(--warn);color:#fff;}

  .footer{display:flex;align-items:center;justify-content:space-between;border-top:1px dashed #e6edff;padding:10px 0;margin-top:8px;color:var(--muted);gap:10px;background:var(--panel);padding-bottom:calc(10px + env(safe-area-inset-bottom));}
  .left-actions,.right-actions{display:flex;gap:8px;align-items:center;}

  .answer-area{margin-top:8px;padding-top:8px;border-top:1px solid #eef2ff;}
  .hint{color:var(--hint);font-weight:600;margin-top:6px;}
  .ans{color:var(--ok);font-weight:800;margin-top:6px;}
  .perQTimer{font-weight:800;color:var(--bad);white-space:nowrap}

  .heading{font-family:Playfair Display,Georgia,serif;font-weight:700;margin:0;text-wrap:balance}
  .stack{display:grid;align-content:center;justify-items:center;gap:12px;}
  .field{width:min(520px,92vw);}

  .input{width:100%;padding:12px 14px;border-radius:12px;border:1.5px solid var(--ring);background:#f8faff;font-size:16px;outline:none;transition:transform 0.2s ease, box-shadow 0.2s ease;}
  .input:focus{border-color:#9bb7ff;transform:translateY(-2px);box-shadow:0 4px 10px rgba(46,91,255,0.1);}
  .subtitle{color:var(--muted);font-weight:600;}

  .scrim{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center;z-index:9999;}
  .dialog{background:#fff;border-radius:16px;padding:18px;box-shadow:var(--shadow);width:min(420px,92vw);}
  .dialog h3{margin:0 0 8px 0;font-family:Playfair Display,Georgia,serif;}
  #board, .scroll-area, .question, .options, .opt {-webkit-user-select:none; -moz-user-select:none; -ms-user-select:none; user-select:none;-webkit-touch-callout:none;}

  /* LOGIN — mobile safe and aligned */
  .login-shell{
    display:grid;place-items:center;
    min-height:calc(100dvh - 56px);
    padding:clamp(12px,4vw,24px);
    padding-left:calc(clamp(12px,4vw,24px) + env(safe-area-inset-left));
    padding-right:calc(clamp(12px,4vw,24px) + env(safe-area-inset-right));
    background:linear-gradient(180deg,#f7f9ff 0%,#eef3ff 100%);
  }
  .login-card{
    width:min(480px,100%);
    background:#fff;border:1px solid var(--ring);border-radius:18px;box-shadow:0 14px 50px rgba(17,24,39,.12);
    padding:clamp(16px,4vw,24px);display:grid;gap:14px;
  }
  .login-head{display:grid;gap:6px;text-align:center;justify-items:center;}
  .login-title{font-family:Playfair Display,Georgia,serif;font-size:clamp(20px,5vw,26px);font-weight:700;margin:0;text-wrap:balance}
  .login-desc{color:var(--muted);font-size:.95rem}
  .label{font-size:.92rem;color:var(--muted);font-weight:700;margin-bottom:6px;display:block}
  .pw-wrap{position:relative}
  .pw-toggle{position:absolute;right:10px;top:50%;transform:translateY(-50%);background:transparent;border:none;color:#17386e;font-weight:700;cursor:pointer;opacity:.8}
  .pw-toggle:hover{opacity:1}
  .login-aux{display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap}
  .login-aux .remember{display:flex;align-items:center;gap:6px;color:var(--muted);font-size:.9rem}
  .login-aux a{color:var(--primary);text-decoration:none;font-weight:700}
  .login-aux a:hover{text-decoration:underline}
  .btn.primary.login-cta{position:relative;overflow:hidden}
  .btn.primary.login-cta.valid::after{content:"";position:absolute;inset:0;background:linear-gradient(120deg,transparent 0%,rgba(255,255,255,.35) 15%,transparent 30%);transform:translateX(-120%);animation:shimmer 1.8s ease-in-out infinite;}
  @keyframes shimmer{60%{transform:translateX(120%);}100%{transform:translateX(120%);}}

  /* DASHBOARD — robust grid on mobile */
  .dash-grid{
    display:grid;
    grid-template-columns: repeat(12, minmax(0, 1fr));
    gap:12px;
  }
  .card{background:var(--card);border:1px solid var(--ring);border-radius:14px;box-shadow:var(--shadow);padding:12px;min-width:0}
  /* MODIFIED: Changed card-muted background to card (white) */
  .card-muted{background:var(--card)}
  .kpi{display:grid;gap:4px;min-width:0}
  .kpi .kpi-label{color:var(--muted);font-weight:700;font-size:.82rem;white-space:nowrap}
  .kpi .kpi-value{color:#0f172a;font-weight:800;font-size:clamp(18px,6vw,26px);line-height:1}
  .kpi .kpi-sub{color:var(--muted);font-weight:600;font-size:.9rem}
  .legend{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .legend-item{display:flex;align-items:center;gap:8px;font-weight:700}
  .legend-dot{width:10px;height:10px;border-radius:999px;display:inline-block}

  /* force canvases to be blocks and shrink properly */
  canvas{display:block;max-width:100%;height:auto}

  /* Added responsive classes for dashboard items */
  .kpi-span-3 { grid-column: span 3; }
  .gauge-span-6 { grid-column: span 6; }
  .donut-span-6 { grid-column: span 6; }
  .timing-span-12 { grid-column: span 12; }

  /* Breakpoints for grid tightening */
  @media(min-width:1100px){ .dash-grid{grid-template-columns:repeat(12, minmax(0,1fr));} }
  /* Added responsive span rules */
  @media(max-width:1099px){ 
    .dash-grid{grid-template-columns:repeat(6, minmax(0,1fr));}
    .timing-span-12 { grid-column: span 6; } /* 12->6 */
  }
  @media(max-width:740px){ 
    .dash-grid{grid-template-columns:repeat(4, minmax(0,1fr));} .top{height:56px} #logo{height:28px} .footer{gap:8px} 
    .kpi-span-3 { grid-column: span 2; } /* 3->2 */
    .gauge-span-6 { grid-column: span 4; } /* 6->4 */
    .donut-span-6 { grid-column: span 4; } /* 6->4 */
    .timing-span-12 { grid-column: span 4; } /* 12->6->4 */
  }
  @media(max-width:480px){ 
    .dash-grid{grid-template-columns:repeat(2, minmax(0,1fr));} .btn{font-size:.95rem} .kpi .kpi-label{font-size:.8rem} 
    .kpi-span-3 { grid-column: span 1; } /* 3->2->1 */
    .gauge-span-6 { grid-column: span 2; } /* 6->4->2 */
    .donut-span-6 { grid-column: span 2; } /* 6->4->2 */
    .timing-span-12 { grid-column: span 2; } /* 12->6->4->2 */
  }

  /* Utilities */
  .visually-hidden{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,1px,1px);white-space:nowrap;border:0;}
</style>
</head>
<body>
<div class="app" id="app">
  <div class="top">
    <div class="brand">
      <img src="https://raw.githubusercontent.com/kmukunda96/smartquiz/main/SMART%20LOGO.jpg" alt="SMART Classes Logo" id="logo" />
    </div>
    <div class="meta" id="topMeta" aria-live="polite"></div>
  </div>
  <div class="stage"><div class="board" id="board" aria-live="polite"></div></div>
</div>

<div class="scrim" id="gateScrim" role="dialog" aria-modal="true" aria-labelledby="gateTitle">
  <div class="dialog">
    <h3 id="gateTitle">Stay Focused</h3>
    <div id="gateTask" class="subtitle" style="margin-bottom:10px;"></div>
    <label class="visually-hidden" for="gateAns">Answer</label>
    <input id="gateAns" class="input" placeholder="Enter answer" inputmode="numeric" />
    <button class="btn primary" style="margin-top:10px;width:100%;" onclick="checkGate()">Continue Test</button>
  </div>
</div>

<div class="scrim" id="submitScrim" role="dialog" aria-modal="true" aria-labelledby="submitTitle">
  <div class="dialog">
    <h3 id="submitTitle">Submit Quiz?</h3>
    <div class="subtitle">Once submitted, answers cannot be changed.</div>
    <div style="display:flex;gap:10px;margin-top:12px;justify-content:flex-end;">
      <button class="btn ghost" onclick="hideSubmit()">Cancel</button>
      <button class="btn danger" onclick="doSubmit()">Submit</button>
    </div>
  </div>
</div>

<div class="scrim" id="screenshotScrim" role="dialog" aria-modal="true" aria-labelledby="screenshotTitle">
  <div class="dialog">
    <h3 id="screenshotTitle">Reminder</h3>
    <div class="subtitle">Please take a screenshot of your results dashboard now for your records.</div>
    <div style="display:flex;gap:10px;margin-top:12px;justify-content:flex-end;">
      <button class="btn primary" style="width:100%;" onclick="hideScreenshotReminder()">OK, Got it</button>
    </div>
  </div>
</div>

<script>
  // Security block (unchanged)
  (function secureBlock(){
    const kill = e => { e.preventDefault(); e.stopPropagation(); return false; };
    ['contextmenu','copy','cut','dragstart','selectstart'].forEach(evt=>document.addEventListener(evt, kill, true));
    document.addEventListener('mousedown', e => { if(e.button===2) kill(e); }, true);
    document.addEventListener('pointerdown', e => { if(e.button===2) kill(e); }, true);
    document.addEventListener('keydown', e => {
      const k=e.key.toLowerCase();
      if((e.ctrlKey||e.metaKey)&&['c','x','s','u','p','a'].includes(k)) kill(e);
      if(k==='f12') kill(e);
      const isQuizContext = (mode === 'timer' || mode === 'results' || mode === 'review');
      if(k === 'escape' && isQuizContext) {
        kill(e);
        ensureFullscreen();
        if(mode === 'timer' && !isGateOpen) openGate();
      }
    }, true);
    let t=null; document.addEventListener('touchstart', e=>{ t=setTimeout(()=>kill(e),400); }, {passive:false,capture:true}); document.addEventListener('touchend', ()=>clearTimeout(t), {capture:true});
  })();

  /* =========================================
     --- QUESTION DATABASE STARTS HERE ---
     "Profit and Loss" questions
     ========================================= */
  const questions = [
    {q:"The ratio of the marked price of the mobile to cost price of the mobile is 5: 3. If 20% of the profit is made, then what is the discount percentage?", options:["22%", "25%", "28%", "26%", "None of these"], answer:1},
    {q:"A shopkeeper marks the price of the article is 20% above its cost price and also offers 10% of the discount. Find the profit percentage?", options:["10%", "8%", "12%", "14%", "None of these"], answer:1},
    {q:"The cost price of a water bottle is Rs. 50. If the marked price is 20% above its cost price and the discount is 5%, find the total discount on selling 19 bottles.", options:["Rs. 3", "Rs. 60", "Rs. 57", "Rs. 51", "Rs. 253"], answer:2},
    {q:"Profit after selling a product for Rs. 850 is the same as the loss after selling it for Rs.710. What is the cost of the product?", options:["780", "240", "620", "540", "none"], answer:0},
    {q:"Ratio of the cost price to marked price of the article is 4: 5. A shopkeeper offers a discount of 15% and the marked price of the article is Rs. 720. What is the profit percentage of the article?", options:["6.25%", "4.75%", "5.5%", "3.40%", "None of these"], answer:0},
    {q:"The marked price of the article is Rs. 1800. If the shopkeeper allows 20% discount on the marked price and then it is sold for Rs.340 profit. What is the cost price of the article?", options:["Rs. 1000", "Rs. 1100", "Rs. 1200", "Rs. 1400", "None of these"], answer:1},
    {q:"The cost price of the mobile is Rs.2000. If the shopkeeper marked up the price by 30% and allowed the discount of 10%, then what is the profit percentage of the mobile?", options:["13%", "15%", "12%", "17%", "None of these"], answer:3},
    {q:"Arun earned a profit of 20% after allowing a discount of 10%. Marked price is what percentage more than cost price?", options:["33.33%", "25%", "45.65%", "56%", "None of these"], answer:0},
    {q:"A shopkeeper bought two articles A and B such that he had a Profit of 15% and 20% on selling article A and B respectively. Selling price of articles A and B is Rs. 230 and Rs. 420 respectively. At what price must that items be sold together in order to gain 30%?", options:["Rs. 686", "Rs. 695", "Rs. 700", "Rs. 740", "None of these"], answer:0},
    {q:"Praveen is a computer shop owner. He purchases the components of a desktop for Rs 6200 and then he spends further Rs 2400 on labour charge to assemble the desktop. If he sells 18 desktops for Rs 175000, then what is the approximate profit percentage?", options:["13%", "11.5%", "12.2%", "14.35%", "8.9%"], answer:2},
    {q:"A man sold an article for Rs. 7600 and incurred a loss. Had he sold the article for Rs.8350, his gain would have been equal to half of the amount of loss that he incurred. At what price should he sell the article to have 20% profit?", options:["Rs. 8560", "Rs. 7680", "Rs. 11240", "Rs. 9720", "None of these"], answer:3},
    {q:"If the selling price of the mobile is Rs. 6000 and the ratio of the marked to cost price of the mobile is 5: 3. If the shopkeeper offers a discount of 20% on the marked price of the mobile, then find the profit percentage of the mobile?", options:["28.28%", "44.44%", "33.33%", "48.48%", "52.52%"], answer:2},
    {q:"Rajesh bought 23 kg of rice at 30 rupees per kg and 32 kg of rice at 35 rupees per kg. Now he sold the entire rice at 42 rupees per kg. Find the amount of loss/profit made by Rajesh.", options:["Rs. 320 profit", "Rs. 410 profit", "Rs. 350 profit", "Rs. 500 profit", "None of these"], answer:1},
    {q:"Ratio of the cost price to marked price of the mobile is 5:6. The shopkeeper offers a discount is 20%. IF the sum of the marked price and cost price of the mobile is Rs. 4400, then what is the profit or loss earned by the shopkeeper?", options:["Rs. 40 profit", "Rs. 80 loss", "Rs. 40 loss", "Rs. 80 profit", "None of these"], answer:1},
    {q:"A man sells a lollipop for Rs. 5. He increases his sale by 20% and decreases price by 10%. Calculate the profit / loss % now the man is making, if he sold lollipops of Rs. 75 earlier.", options:["10% Profit", "9% Profit", "8% Profit", "12% Profit", "None of these"], answer:2},
    {q:"The Ratio of cost price of an article to marked price of the article is x: 5. If the selling price of the article is Rs. 4400 and the shopkeeper also offers 20% of discount on marked price of the article, then the marked price of an article is what percent more than that of cost price, if the profit earned by the shopkeeper is 10% ?", options:["28.5%", "32.7%", "33.60%", "37.5%", "None of these"], answer:3},
    {q:"A man sold a TV for Rs. 13000 and incurred a loss. Had he sold the TV for Rs. 21000, his gain would have been equal to three times of the amount of loss that he incurred. At what price should he sell the TV to gain 20% ?", options:["Rs. 18000", "Rs. 20000", "Rs. 24000", "Rs. 26000", "None of these"], answer:0},
    {q:"Renu sold article A at a loss of 10%. She sold article B at a price which was 25% more than the selling price of article A. If she made a profit of 20% on article B, by what percent is the cost price of article A more than that of article B?", options:["18/5%", "20/3%", "23/3%", "24/5%", "None of these"], answer:1},
    // MODIFIED: Added \n (line breaks) to question 19
    {q:"Reeta sold an article at a discount of __% on marked price, yet she earned a profit of 20% on its cost price. Marked price of the article is Rs.400. Cost price of the article is Rs.__. Which of the following options satisfy the given condition?\nI. 10%, 300\nII. 16%, 280\nIII. 7%, 320", options:["Only I", "Only II", "Only III", "Both I and II", "Both II and III"], answer:3},
    {q:"The selling price of the mobile is 60% more than the selling price of watch and the ratio of the marked to cost price of the mobile is 5: 4. If the shopkeeper offered a discount of mobile is 12%, while he gets the profit of Rs. 400 and the cost price of the Watch is half of the cost price of mobile and then find the profit percentage of watch.", options:["25%", "37.5%", "45%", "56.3%", "None of these"], answer:1}
  ];
  /* --- QUESTION DATABASE ENDS HERE --- */

  // State
  const board=document.getElementById('board'), topMeta=document.getElementById('topMeta');
  // ADDED: screenshotScrim
  const gateScrim=document.getElementById('gateScrim'), submitScrim=document.getElementById('submitScrim'), screenshotScrim=document.getElementById('screenshotScrim');
  let user="", mode="", q=0, selected=-1;
  let results=[], perTimes=[], perStop={}, perStart={}, perInt={};
  let mainTimer=null, practiceWatch=null, practiceElapsed=0;
  let gateA=0, gateB=0, isGateOpen=false;
  let fullscreenCheckInterval = null;

  function ensureFullscreen(){ document.body.classList.add('fs-lock'); const el=document.documentElement; try{ if(!document.fullscreenElement && el.requestFullscreen) el.requestFullscreen(); }catch(e){} }
  function pauseAllTimers(){ if (mainTimer) { clearInterval(mainTimer); mainTimer = null; } if (practiceWatch) { clearInterval(practiceWatch); practiceWatch = null; } pausePerStopwatch(q); }
  function resumeAllTimers(){ if (mode === 'timer' && !practiceWatch) { practiceWatch = setInterval(() => { practiceElapsed++; const el = document.getElementById('swPill'); if (el) el.textContent = 'Stopwatch: ' + fmt(practiceElapsed); }, 1000); } startPerStopwatch(); }

  document.addEventListener('fullscreenchange', () => {
    const isQuizActive = mode === 'timer';
    if (document.fullscreenElement && isQuizActive) { if (!isGateOpen) resumeAllTimers(); }
    else if (!document.fullscreenElement) { if (isQuizActive) { openGate(); } else if (mode === 'results' || mode === 'review') { ensureFullscreen(); } }
  });
  document.addEventListener('visibilitychange', () => {
    const isQuizActive = mode === 'timer';
    if (document.visibilityState === 'hidden' && isQuizActive && !isGateOpen) { openGate(); }
    else if (document.visibilityState === 'visible' && isQuizActive && !isGateOpen) { openGate(); }
  });

  function openGate(){ if (isGateOpen) return; isGateOpen = true; pauseAllTimers(); gateA = 100 + Math.floor(Math.random()*900); gateB = Math.floor(Math.random()*900); if(gateB>=gateA) gateB = Math.floor(gateA/2); document.getElementById('gateTask').textContent = `Solve to continue: ${gateA} - ${gateB} = ?`; document.getElementById('gateAns').value = ""; gateScrim.style.display='flex'; }
  function checkGate(){ const val = Number(document.getElementById('gateAns').value.trim()); if(val === (gateA - gateB)){ gateScrim.style.display='none'; isGateOpen = false; ensureFullscreen(); resumeAllTimers(); } else { alert('Incorrect, try again.'); } }
  
  // ADDED: Function to hide the new reminder
  function hideScreenshotReminder(){ screenshotScrim.style.display = 'none'; }

  function renderTopMeta(){
    const label = mode === 'timer' ? 'Stopwatch Mode' : '—';
    const timePill = mode === 'timer' ? `<span class="pill timer-pill" id="swPill">Stopwatch: ${fmt(practiceElapsed)}</span>` : '';
    topMeta.innerHTML = `<span class="pill">${label}</span>${timePill}`;
  }
  function fmt(secs){ const m=Math.floor(secs/60), s=secs%60; return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`; }

  // LOGIN
  function loginView(){
    mode=""; renderTopMeta();
    board.innerHTML = `
      <section class="login-shell" aria-label="Login">
        <form class="login-card" onsubmit="doLogin(); return false;" novalidate>
          <div class="login-head">
            <img src="https://raw.githubusercontent.com/kmukunda96/smartquiz/main/SMART%20LOGO.jpg" alt="SMART Classes" style="height:46px;border-radius:8px;" />
            <h2 class="login-title">Sign in to SMART Classes</h2>
            <p class="login-desc">Enter your credentials to continue</p>
          </div>
          <div>
            <label class="label" for="name">Name</label>
            <input id="name" class="input" placeholder="Student name" autocomplete="name" required autofocus />
          </div>
          <div>
            <label class="label" for="pass">Password</label>
            <div class="pw-wrap">
              <input id="pass" class="input" type="password" placeholder="Password" autocomplete="current-password" required />
              <button type="button" class="pw-toggle" id="pwToggle" aria-label="Show password">Show</button>
            </div>
          </div>
          <div class="login-aux">
            <label class="remember"><input type="checkbox" /> Remember me</label>
            <a href="#" onclick="alert('Contact your instructor to reset.'); return false;">Forgot password?</a>
          </div>
          <button id="loginBtn" class="btn primary login-cta" style="width:100%;" type="submit">Sign in</button>
          <p class="login-footnote">Use your registered name. Password is case-sensitive.</p>
        </form>
      </section>`;
    const nameEl=document.getElementById('name');
    const passEl=document.getElementById('pass');
    const btn=document.getElementById('loginBtn');
    const pwToggle=document.getElementById('pwToggle');
    const toggleValid=()=>{ if(nameEl.value.trim().length>1 && passEl.value.trim().length>=3) btn.classList.add('valid'); else btn.classList.remove('valid'); };
    nameEl.addEventListener('input', toggleValid); passEl.addEventListener('input', toggleValid);
    pwToggle.addEventListener('click', ()=>{ const isPw = passEl.type === 'password'; passEl.type = isPw ? 'text' : 'password'; pwToggle.textContent = isPw ? 'Hide' : 'Show'; pwToggle.setAttribute('aria-label', isPw ? 'Hide password' : 'Show password'); });
  }
  function doLogin(){ const n=document.getElementById('name').value.trim(), p=document.getElementById('pass').value; if(!n) return alert('Enter name'); if(p!=='214214214') return alert('Incorrect password'); user=n; deviceView(); }

  // Device / Mode (unchanged)
  function deviceView(){
    mode=""; renderTopMeta();
    board.innerHTML = `
      <div class="stack" style="min-height:calc(100dvh - 128px); place-items:center; justify-items:center;">
        <h2 class="heading">Choose Device</h2>
        <div class="field" style="display:grid;gap:12px;">
          <button class="btn primary" onclick="initiateMobileMode()">Mobile</button>
          <button class="btn ghost" onclick="setDevice('desktop')">Computer / Laptop</button>
          <button class="btn warn" onclick="loginView()">Back</button>
        </div>
      </div>`;
  }
  function initiateMobileMode(){ ensureFullscreen(); if (fullscreenCheckInterval) clearInterval(fullscreenCheckInterval);
    board.innerHTML=`<div class="stack" style="min-height:calc(100dvh - 128px); place-items:center; justify-items:center;">
      <h2 class="heading">Activating Fullscreen...</h2><div class="subtitle">Please allow fullscreen to begin the quiz. The test will start automatically.</div></div>`;
    let attempts=0; fullscreenCheckInterval=setInterval(()=>{ if (document.fullscreenElement) { clearInterval(fullscreenCheckInterval); modeView(); } else { attempts++; if (attempts>20){ clearInterval(fullscreenCheckInterval); board.innerHTML=`<div class="stack" style="min-height:calc(100dvh - 128px); place-items:center; justify-items:center;"><h2 class="heading">Fullscreen Required</h2><div class="subtitle" style="text-align:center; margin-bottom:12px;">You must enable fullscreen mode to take the quiz on a mobile device.</div><button class="btn primary" onclick="initiateMobileMode()">Retry</button><button class="btn ghost" onclick="deviceView()">Go Back</button></div>`; } } },250);
  }
  function setDevice(deviceType){ if (deviceType==='desktop'){ ensureFullscreen(); modeView(); } }
  function modeView(){
    mode=""; renderTopMeta();
    board.innerHTML = `
      <div class="stack" style="min-height:calc(100dvh - 128px); place-items:center; justify-items:center;">
        <h2 class="heading">Select Mode</h2>
        <div class="field" style="display:grid;gap:12px;">
          <button class="btn primary" onclick="start('timer')">Start Quiz (Stopwatch)</button>
        </div>
      </div>`;
  }

  // Quiz
  function start(m){
    mode=m; q=0; selected=-1; results=[]; perTimes=[]; perStop={}; perStart={};
    clearInterval(mainTimer); clearInterval(practiceWatch);
    if(mode==='timer'){ practiceElapsed=0; renderTopMeta(); }
    renderQuestion(); ensureFullscreen();
  }
  function startPerStopwatch(){ if (perInt[q] || isGateOpen) return; if(perStop[q]==null) perStop[q]=0; perStart[q]=Date.now(); perInt[q]=setInterval(()=>{ const sec=Math.floor((Date.now()-perStart[q])/1000)+(perStop[q]||0); const el=document.getElementById('perTimer'); if(el) el.textContent='Q stopwatch: '+fmt(sec); },500); }
  function pausePerStopwatch(i){ if(perStart[i]){ perStop[i]=(perStop[i]||0)+Math.floor((Date.now()-perStart[i])/1000); perStart[i]=null; } if(perInt[i]){ clearInterval(perInt[i]); perInt[i]=null; } }

  function renderQuestion(){
    if(q>=questions.length){ submitConfirm(); return; }
    selected = (results[q] && results[q].pick !== undefined) ? results[q].pick : -1;
    const d=questions[q];
    const opts = d.options.map((t,i)=>{ const isSelected=(i===selected)?' selected':''; const animDelay=(results[q]?0:i*60); return `<div class="opt${isSelected}" style="animation-delay:${animDelay}ms" id="opt${i}" onclick="pick(${i})">${t}</div>`; }).join('');
    board.innerHTML = `
      <div class="qbar">
        <div>Question ${q+1} / ${questions.length}</div>
        <div class="perQTimer" id="perTimer">Q stopwatch: 00:00</div>
      </div>
      <div class="scroll-area" id="quizScroll">
        <div class="question">${d.q}</div>
        <div class="options">${opts}</div>
        <div class="answer-area">
          <div class="ans" id="ansBox" style="display:none;"></div>
          <div class="hint" id="hintBox" style="display:none;"></div>
        </div>
      </div>
      <div class="footer">
        <div class="left-actions">
          <button class="btn ghost" onclick="prev()" ${q===0?'disabled style="opacity:0.5"':''}>Previous</button>
          <button class="btn warn" onclick="skip()">Skip</button>
        </div>
        <div class="right-actions">
          <button class="btn primary" onclick="next()">Next</button>
          <button class="btn danger" onclick="submitConfirm()">Submit</button>
        </div>
      </div>`;
    resumeAllTimers();
  }

  function pick(i){ selected=i; for(let k=0;k<questions[q].options.length;k++){ const el=document.getElementById('opt'+k); if(el) el.classList.remove('selected'); } const cur=document.getElementById('opt'+i); if(cur) cur.classList.add('selected'); }
  function showAnswer(){ if(selected<0){ alert('Select an option first'); return; } const d=questions[q]; const box=document.getElementById('ansBox'); box.style.display='block'; box.textContent='Correct answer: '+d.options[d.answer]; }
  function showHint(){ const d=questions[q]; if(d.hint){ const box=document.getElementById('hintBox'); box.style.display='block'; box.textContent='Hint: '+d.hint; } }
  function prev(){ if(q===0) return; perTimes[q]=perStop[q]||0; if (selected !== -1) { results[q]={pick:selected, correct:(selected===questions[q].answer)}; } else if (!results[q]) { results[q]={pick:-1, correct:false}; } pausePerStopwatch(q); q--; renderQuestion(); }
  function skip(){ recordAndGo(-1); }
  function next(){ recordAndGo(selected); }
  function recordAndGo(choice){ pausePerStopwatch(q); perTimes[q]=perStop[q]||0; results[q]={pick:choice, correct:(choice===questions[q].answer)}; q++; renderQuestion(); }

  function submitConfirm(){ submitScrim.style.display='flex'; }
  function hideSubmit(){ submitScrim.style.display='none'; }
  function doSubmit(){
    hideSubmit(); pauseAllTimers(); Object.keys(perInt).forEach(i=>{ if(perInt[i]) clearInterval(perInt[i]); });
    for(let i=0;i<questions.length;i++){
      if(perTimes[i]==null){ if(perStart[i]) pausePerStopwatch(i); perTimes[i]=perStop[i]||0; }
      if(results[i]==null) results[i]={pick:-1, correct:false};
    }
    mode='results'; resultView();
  }

  // Charts
  function drawGauge(id,val,label){
    const c=document.getElementById(id); if(!c) return;
    const ctx=c.getContext('2d'),w=c.width,h=c.height,r=Math.min(w,h)/2-8,cx=w/2,cy=h-8;
    ctx.clearRect(0,0,w,h);
    ctx.lineWidth=14; ctx.strokeStyle='#e9eefc'; ctx.beginPath(); ctx.arc(cx,cy,r,Math.PI,2*Math.PI); ctx.stroke();
    const ang=Math.PI+(val/100)*Math.PI; ctx.strokeStyle= val>=50 ? '#10b981' : '#ef4444'; ctx.beginPath(); ctx.arc(cx,cy,r,Math.PI,ang); ctx.stroke();
    ctx.fillStyle='#0f1a2a'; ctx.font='700 18px Inter'; ctx.textAlign='center'; ctx.fillText(val+'%',cx,cy-6);
    ctx.fillStyle='#5f6b85'; ctx.font='600 12px Inter'; ctx.fillText(label,cx,cy+18);
  }
  function drawHistogram(id,data){
    const c=document.getElementById(id); if(!c) return;
    const ctx=c.getContext('2d'),w=c.width,h=c.height;
    ctx.clearRect(0,0,w,h);
    const max=Math.max(...data,1), bw=Math.max(2,Math.floor(w/data.length)-2);
    data.forEach((v,i)=>{
      const bh=Math.round((v/max)*(h-10));
      ctx.fillStyle='#2e5bff22'; ctx.fillRect(i*(bw+2), h-bh, bw, bh);
      ctx.fillStyle='#2e5bff'; ctx.fillRect(i*(bw+2), h-bh, bw, 4);
    });
  }
  function drawDonut(id, segments, colors, centerMainText, centerSubText){
    const c=document.getElementById(id); if(!c) return; const ctx=c.getContext('2d'), w=c.width, h=c.height;
    const r=Math.min(w,h)/2-10, cx=w/2, cy=h/2;
    ctx.clearRect(0,0,w,h);
    const total=Math.max(1, segments.reduce((a,b)=>a+b,0));
    let ang=-Math.PI/2; ctx.lineWidth=18;
    segments.forEach((v,i)=>{
      const a2=ang+(v/total)*Math.PI*2;
      ctx.beginPath(); ctx.strokeStyle=colors[i];
      ctx.arc(cx,cy,r,ang,a2); ctx.stroke();
      ang=a2;
    });
    ctx.beginPath(); ctx.fillStyle='#fff'; ctx.arc(cx,cy,r-20,0,Math.PI*2); ctx.fill();
    if(centerMainText){
      ctx.fillStyle='#0f1a2a'; ctx.font='800 22px Inter'; ctx.textAlign='center'; ctx.textBaseline='middle';
      ctx.fillText(centerMainText, cx, cy-6);
    }
    if(centerSubText){
      ctx.fillStyle='#5f6b85'; ctx.font='600 12px Inter';
      ctx.fillText(centerSubText, cx, cy+12);
    }
  }

  // RESULTS — responsive dashboard without overlap
  function resultView(){
    const correct = results.filter(r=>r.correct).length, wrong = results.filter(r=>r.pick>=0 && !r.correct).length, skipped = results.filter(r=>r.pick<0).length;
    const accuracy = Math.round((correct/(results.length||1))*100);
    const total = perTimes.reduce((a,b)=>a+b,0);
    const timesOverall = perTimes.slice();
    const avg = timesOverall.length ? Math.round(timesOverall.reduce((a,b)=>a+b,0)/timesOverall.length) : 0;
    const med = (()=>{ const s=[...timesOverall].sort((a,b)=>a-b), n=s.length; if(!n) return 0; return n%2? s[(n-1)/2] : Math.round((s[n/2-1]+s[n/2])/2); })();

    board.innerHTML = `
      <div class="qbar"><h2 class="heading" style="font-size:clamp(18px,6vw,22px);">Results Dashboard</h2><div class="subtitle" style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:50%;">Name: ${user}</div></div>
      <div class="scroll-area">
        <section class="dash-grid" aria-label="Analytics overview">
          <div class="card kpi kpi-span-3">
            <div class="kpi-label">Accuracy</div><div class="kpi-value">${accuracy}%</div><div class="kpi-sub">Overall correctness</div>
          </div>
          <div class="card kpi kpi-span-3">
            <div class="kpi-label">Correct</div><div class="kpi-value">${correct}</div><div class="kpi-sub">Right answers</div>
          </div>
          <div class="card kpi kpi-span-3">
            <div class="kpi-label">Wrong</div><div class="kpi-value">${wrong}</div><div class="kpi-sub">Marked incorrect</div>
          </div>
          <div class="card kpi kpi-span-3">
            <div class="kpi-label">Skipped</div><div class="kpi-value">${skipped}</div><div class="kpi-sub">Unattempted</div>
          </div>

          <div class="card gauge-span-6">
            <h3 class="subtitle" style="margin:0 0 6px 0;">Score</h3>
            <canvas id="scoreGauge" width="360" height="160"></canvas>
            <div style="margin-top:8px;display:grid;grid-template-columns:repeat(3,1fr);gap:8px;">
              <div class="kpi"><div class="kpi-label">Total time</div><div class="kpi-value">${fmt(total)}</div></div>
              <div class="kpi"><div class="kpi-label">Average</div><div class="kpi-value">${fmt(avg)}</div></div>
              <div class="kpi"><div class="kpi-label">Median</div><div class="kpi-value">${fmt(med)}</div></div>
            </div>
          </div>

          <div class="card donut-span-6">
            <h3 class="subtitle" style="margin:0 0 6px 0;">Answer distribution</h3>
            <div class="legend" style="margin-bottom:6px;">
              <span class="legend-item"><span class="legend-dot" style="background:#10b981"></span>Correct: ${correct}</span>
              <span class="legend-item"><span class="legend-dot" style="background:#ef4444"></span>Wrong: ${wrong}</span>
              <span class="legend-item"><span class="legend-dot" style="background:#94a3b8"></span>Skipped: ${skipped}</span>
            </div>
            <canvas id="distDonut" width="260" height="160"></canvas>
          </div>

          <div class="card timing-span-12">
            <h3 class="subtitle" style="margin:0 0 6px 0;">Per-question timing</h3>
            <canvas id="timeHist" width="980" height="150"></canvas>
            <div style="margin-top:8px; overflow:auto; border:1px solid #eef2ff; border-radius:12px;">
              <table style="width:100%; border-collapse:collapse;">
                <thead><tr style="background:#f8fbff;"><th style="text-align:left;padding:10px;">Question</th><th style="text-align:left;padding:10px;">Time</th></tr></thead>
                <tbody>
                  ${results.map((r,i)=>{ const t=perTimes[i]||0; const td=(t>200)?`<span style="color:var(--bad); font-weight:700;">${fmt(t)} (Limit)</span>`:fmt(t);
                    return `<tr><td style="padding:10px;border-top:1px solid #eef2ff;">Q${i+1}</td><td style="padding:10px;border-top:1px solid #eef2ff;">${td}</td></tr>`;
                  }).join('')}
                </tbody>
              </table>
            </div>
          </div>
        </section>
      </div>
      <div class="footer">
        <div></div>
        <div class="right-actions">
          <button class="btn primary" onclick="review()">Review Answers</button>
          <button class="btn ghost" onclick="modeView()">Back to Modes</button>
        </div>
      </div>`;

    setTimeout(()=>{
      drawGauge('scoreGauge', Math.max(0,Math.min(100, Math.round((correct/questions.length)*100))), 'Score');
      drawHistogram('timeHist', perTimes.slice());
      drawDonut('distDonut', [correct, wrong, skipped], ['#10b981','#ef4444','#94a3b8'], accuracy+'%', 'accuracy');
      
      // Show the screenshot reminder
      screenshotScrim.style.display = 'flex';
    },0);
  }

  // Review
  function review(){
    let html='';
    results.forEach((r,i)=>{
      const d=questions[i];
      const t=perTimes[i]||0;
      const td=(t>200)?`<span style="color:var(--bad); font-weight:700;">${fmt(t)} (Limit)</span>`:`<span style="color:#5f6b85">${fmt(t)}</span>`;
      html += `
        <div style="padding:10px 0;border-bottom:1px solid #eef2ff">
          <div><b>Q${i+1}.</b> ${d.q}</div>
          <div style="color:${r.correct? '#10b981':'#ef4444'};font-weight:800;">Your: ${r.pick>=0?d.options[r.pick]:'—'} ${r.correct?'✔️':'❌'}</div>
          <div>Correct: ${d.options[d.answer]}</div>
          <div>Time: ${td}</div>
        </div>`;
    });
    board.innerHTML = `
      <div class="qbar"><div class="heading" style="font-size:20px;">Review</div><div class="subtitle" style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:50%;">Name: ${user}</div></div>
      <div class="scroll-area" style="padding-right:4px;">${html}</div>
      <div class="footer"><div></div><div class="right-actions"><button class="btn ghost" onclick="resultView()">Back to Results</button></div></div>`;
    ensureFullscreen();
  }
  
  // REMOVED: takeScreenshot function

  // API
  window.checkGate=checkGate; window.review=review; window.modeView=modeView;
  window.doLogin=doLogin; window.setDevice=setDevice; window.start=start;
  window.next=next; window.prev=prev; window.skip=skip; window.showHint=showHint; window.showAnswer=showAnswer; window.pick=pick;
  window.submitConfirm=submitConfirm; window.hideSubmit=hideSubmit; window.doSubmit=doSubmit; window.resultView=resultView;
  window.initiateMobileMode = initiateMobileMode; window.deviceView = deviceView;
  window.hideScreenshotReminder = hideScreenshotReminder;

  // Init
  loginView();
</script>
</body>
</html>